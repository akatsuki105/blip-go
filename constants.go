package blip

// Maximum clock_rate/sample_rate ratio. For a given sample_rate,
// clock_rate must not be greater than sample_rate*blip_max_ratio.
const MaxRatio = 0x100000

// Maximum number of samples that can be generated from one time frame.
const MaxFrame = 4000

const (
	preShift      = 32
	timeBits      = preShift + 20
	timeUnit      = 1 << timeBits
	bassShift     = 9
	endFrameExtra = 2
	halfWidth     = 8
	bufExtra      = halfWidth*2 + endFrameExtra
	phaseBits     = 5
	phaseCount    = 1 << 5
	deltaBits     = 15
	deltaUnit     = 1 << deltaBits
	fracBits      = timeBits - preShift
)

const (
	maxSample = 32767
	minSample = -32768
)

var blStep = [phaseCount + 1][halfWidth]int16{
	{43, -115, 350, -488, 1136, -914, 5861, 21022},
	{44, -118, 348, -473, 1076, -799, 5274, 21001},
	{45, -121, 344, -454, 1011, -677, 4706, 20936},
	{46, -122, 336, -431, 942, -549, 4156, 20829},
	{47, -123, 327, -404, 868, -418, 3629, 20679},
	{47, -122, 316, -375, 792, -285, 3124, 20488},
	{47, -120, 303, -344, 714, -151, 2644, 20256},
	{46, -117, 289, -310, 634, -17, 2188, 19985},
	{46, -114, 273, -275, 553, 117, 1758, 19675},
	{44, -108, 255, -237, 471, 247, 1356, 19327},
	{43, -103, 237, -199, 390, 373, 981, 18944},
	{42, -98, 218, -160, 310, 495, 633, 18527},
	{40, -91, 198, -121, 231, 611, 314, 18078},
	{38, -84, 178, -81, 153, 722, 22, 17599},
	{36, -76, 157, -43, 80, 824, -241, 17092},
	{34, -68, 135, -3, 8, 919, -476, 16558},
	{32, -61, 115, 34, -60, 1006, -683, 16001},
	{29, -52, 94, 70, -123, 1083, -862, 15422},
	{27, -44, 73, 106, -184, 1152, -1015, 14824},
	{25, -36, 53, 139, -239, 1211, -1142, 14210},
	{22, -27, 34, 170, -290, 1261, -1244, 13582},
	{20, -20, 16, 199, -335, 1301, -1322, 12942},
	{18, -12, -3, 226, -375, 1331, -1376, 12293},
	{15, -4, -19, 250, -410, 1351, -1408, 11638},
	{13, 3, -35, 272, -439, 1361, -1419, 10979},
	{11, 9, -49, 292, -464, 1362, -1410, 10319},
	{9, 16, -63, 309, -483, 1354, -1383, 9660},
	{7, 22, -75, 322, -496, 1337, -1339, 9005},
	{6, 26, -85, 333, -504, 1312, -1280, 8355},
	{4, 31, -94, 341, -507, 1278, -1205, 7713},
	{3, 35, -102, 347, -506, 1238, -1119, 7082},
	{1, 40, -110, 350, -499, 1190, -1021, 6464},
	{0, 43, -115, 350, -488, 1136, -914, 5861},
}
